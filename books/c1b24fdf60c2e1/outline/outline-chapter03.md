# 第3章: Microsoft Entra ID構築 - アウトライン（運用管理特化版）

## 構成方針
- 自動化・効率化を重視したID管理基盤の構築
- 教育機関特有の組織構造への対応
- 運用負荷軽減のための高度な設定活用

## 3.1 ディレクトリ設計【既存維持・運用観点強化】

### 3.1.1 教育機関向け組織構造設計
- **階層構造の運用最適化**
  - 教育委員会→学校→学年→クラス の4層構造
  - 部門単位（管理部・教務部・学年部）の横断組織
  - 特別支援・国際学級等の特殊組織への対応
  - 将来の組織変更に対応できる柔軟な設計

- **命名規則の標準化**
  - ユーザーアカウント：姓名-学校コード-入学年度
  - グループ名：用途-学校-学年-クラス の統一形式
  - 管理単位：role-school-department の構造化
  - 例外処理ルールの明文化と適用基準

### 3.1.2 ユーザー属性設計
- **教育機関特有の属性**
  - 職員コード・学籍番号の管理
  - 在籍状況（在学・休学・退学・卒業）
  - 学年・クラス・出席番号
  - 教科担当・役職・委員会所属

- **ライフサイクル管理属性**
  - 入学年度・卒業予定年度
  - 異動・転校履歴
  - アカウント有効期間
  - データ保持期間・削除スケジュール

## 3.2 ハイブリッドアイデンティティ【既存維持・運用観点強化】

### 3.2.1 Azure AD Connect運用管理
- **同期プロセスの運用監視**
  - 同期エラーの自動検出・通知
  - 同期遅延の監視・アラート
  - 差分同期と完全同期の使い分け
  - 同期ログの定期分析・保管

- **同期ルールのカスタマイズ**
  - 教育機関特有の属性マッピング
  - 条件付き同期ルールの設定
  - 同期除外オブジェクトの管理
  - カスタム属性の同期設定

### 3.2.2 オンプレミスAD連携の運用
- **ADサイト・サービス連携**
  - 地理的分散環境での最適化
  - WAN回線を考慮した同期スケジュール
  - 災害時のフェイルオーバー設定
  - パフォーマンス監視・チューニング

## 3.3 認証・アクセス制御【既存維持・運用観点強化】

### 3.3.1 多要素認証（MFA）の運用管理
- **段階的MFA展開**
  - 管理者：即座適用（100%）
  - 教職員：段階的展開（4週間で100%）
  - 生徒：年齢・学年に応じた適用
  - ゲスト：厳格な認証要求

- **MFA方法の選択と管理**
  - Microsoft Authenticator推奨設定
  - SMS・音声通話の補完利用
  - ハードウェアトークン（管理者向け）
  - 一時的な認証コード（緊急時）

### 3.3.2 条件付きアクセスの運用設計
- **教育機関向けポリシー設計**
  - 校内ネットワーク：制限緩和
  - 校外アクセス：厳格な認証
  - 未知デバイス：ブロックまたは制限
  - 高リスクサインイン：自動ブロック

- **ポリシーの段階的展開**
  - テストグループでの検証
  - パイロット展開（10%のユーザー）
  - 段階的拡大（25% → 50% → 100%）
  - 問題発生時のロールバック手順

## 3.4 運用効率化のための高度な設定【新設】

### 3.4.1 動的グループの積極活用
- **学年・クラス別の自動グループ作成**
  - 属性ベースの自動メンバーシップ
    ```
    user.department -eq "小学1年" -and user.extension_attribute1 -eq "A組"
    ```
  - 進級時の自動グループ移動
  - 転校・転出時の自動グループ除外
  - 卒業時の自動アーカイブグループ移動

- **職員・教員・生徒の自動分類**
  - 職種別グループの自動割り当て
    ```
    user.jobTitle -contains "教諭" -or user.jobTitle -contains "講師"
    ```
  - 権限レベル別の自動グループ作成
  - 委員会・部活動等の横断組織対応
  - 一時職員・非常勤職員の自動分類

- **卒業・転校時の自動除外**
  - 卒業予定日による自動除外設定
  - 転校フラグによる即座除外
  - アカウント無効化の段階的処理
  - データアーカイブグループへの自動移動

### 3.4.2 管理単位の委任設定
- **学校別管理者の権限委任**
  - 管理単位（AU：Administrative Unit）の活用
  - 学校単位での限定的な管理権限
  - 校長・教頭への部分的な管理権限
  - IT担当教員への技術管理権限

- **限定的な管理権限の付与**
  - ユーザー管理：パスワードリセット・アカウント有効化
  - グループ管理：学級・部活動グループの管理
  - ライセンス管理：基本ライセンスの割り当て
  - 監査：自校のログ・レポート閲覧権限

- **セキュリティ境界の明確化**
  - 管理単位間のデータ隔離
  - 権限の最小化原則の適用
  - 権限昇格の防止設定
  - 管理アクションの監査ログ

### 3.4.3 ライフサイクル管理の自動化
- **アカウント作成の自動化**
  - HRシステム・校務システムとの連携
  - 事前定義されたテンプレートの適用
  - 必要なグループ・ライセンスの自動割り当て
  - 初期パスワード・MFA設定の自動化

- **定期的なアクセスレビュー**
  - 四半期ごとの権限確認
  - 長期未使用アカウントの特定
  - 職員異動に伴う権限調整
  - ゲストアカウントの定期見直し

- **アカウント無効化・削除の自動化**
  - 退職・卒業日の自動処理
  - データ保持期間後の自動削除
  - 法的要件に応じた保持・削除
  - 関連リソースの整理・移管

### 3.4.4 セルフサービス機能の活用
- **セルフサービスパスワードリセット（SSPR）**
  - 年齢・学年に応じた認証方法設定
  - 保護者メール・電話番号の活用
  - セキュリティ質問の教育機関向けカスタマイズ
  - リセット頻度・制限の適切な設定

- **セルフサービスグループ管理**
  - 部活動・委員会グループの自己管理
  - 承認ワークフローの設定
  - 管理者監視・監査の仕組み
  - 不適切な利用の防止策

### 3.4.5 監視・レポートの自動化
- **Identity Protection活用**
  - リスクベースの条件付きアクセス
  - 異常なサインインパターンの検出
  - パスワードスプレー攻撃の防御
  - 漏洩した資格情報の自動検出

- **サインインログの分析**
  - 教育機関特有の利用パターン分析
  - 異常アクセスの早期発見
  - 地理的アクセスパターンの監視
  - 休日・夜間アクセスの監視

- **定期レポートの自動生成**
  - 月次アクセス統計レポート
  - セキュリティインシデントレポート
  - ライセンス使用状況レポート
  - コンプライアンス状況レポート